import argparse
import numpy as np
import pandas as pd

import mayavi.mlab

import os

from hypersim_load_obj_file_util import load_obj_file


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--obj_file", type=str, required=True)
    parser.add_argument("--csv_file", type=str, required=True)
    args = parser.parse_args()

    # read obj file generated by UE
    mesh_opacity = 0.7

    isim_obj_file = load_obj_file(args.obj_file)

    print(isim_obj_file.vertices.shape)
    print(isim_obj_file.vertices.dtype)

    # mesh_color_vals = np.arange(isim_obj_file.vertices.shape[0])
    # np.random.shuffle(mesh_color_vals)

    mesh_faces_oi_unique = np.unique(isim_obj_file.faces_oi)
    color_vals_unique = np.arange(mesh_faces_oi_unique.shape[0])
    np.random.shuffle(color_vals_unique)
    mesh_color_vals = np.zeros((isim_obj_file.vertices.shape[0]))
    for oi,color_val in zip(mesh_faces_oi_unique,color_vals_unique):
        mesh_color_vals[ isim_obj_file.faces_vi[ oi == isim_obj_file.faces_oi ].ravel() ] = color_val

    mayavi.mlab.triangular_mesh(isim_obj_file.vertices[:,0], isim_obj_file.vertices[:,1], isim_obj_file.vertices[:,2], isim_obj_file.faces_vi, scalars=mesh_color_vals, representation="surface", opacity=mesh_opacity)

    # read csv file from sampling random poses from navmesh
    df = pd.read_csv(args.csv_file, delimiter=',')
    v_x = -df.iloc[:,0].to_numpy()#[::2]
    v_y = df.iloc[:,2].to_numpy()#[::2]
    v_z = -df.iloc[:,1].to_numpy()#[::2]
    mayavi.mlab.points3d(v_x, v_y, v_z, opacity=1.0, scale_factor=1.2)

    mayavi.mlab.show()
    
# 123, 132, 231, 213, 312, 321
